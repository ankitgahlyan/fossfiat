(self.webpackChunkmytonwallet=self.webpackChunkmytonwallet||[]).push([[803],{32693:(t,e,n)=>{"use strict";n.d(e,{Hz:()=>s,PY:()=>c,Ro:()=>i,eZ:()=>o,fE:()=>r,mN:()=>l,xk:()=>a});let r=function(t){return t.v3R2="v3r2",t.v4R2="v4",t}({});const a=0,i="v4R2",o=3,s=125,c=10,l=!1},50243:(t,e,n)=>{"use strict";n.r(e),n.d(e,{connectLedger:()=>U,detectAvailableTransports:()=>R,getNextLedgerWallets:()=>M,getTransport:()=>F,hasUsbDevice:()=>T,importLedgerWallet:()=>z,openSystemBluetoothSettings:()=>N,reconnectLedger:()=>k,verifyAddress:()=>I,waitLedgerTonApp:()=>C});var r=n(68238),a=n(7416),i=n(34557),o=n(31481),s=n(76944),c=n(3476),l=n(23174);class u extends Error{constructor(t,e){super(t),this.displayError=e,this.name=this.constructor.name}}class d extends u{constructor(t,e){super(t,l.QD.ServerError),this.statusCode=e}}var w=n(86243),f=n(55029),v=n(37836),p=n(82393),h=n(32693),y=n(59301);let b,A,g,m,L,E,S,H,P;async function x(){if(o.UMQ)return E||(E=Promise.all([n.e(580),n.e(513),n.e(642)]).then(n.bind(n,17642)).then((t=>t.BleConnector)),S=await E),E}async function D(){if(p.xy){if(!L){L=Promise.all([n.e(580),n.e(897)]).then(n.bind(n,52897)).then((t=>({transport:t.HIDTransport,listLedgerDevices:t.listLedgerDevices})));const t=await L;H=t.transport,P=t.listLedgerDevices}return L}}async function R(){await x(),await D();const[t,e,n]=await Promise.all([p.xy?H.isSupported():r.A.isSupported(),!!S&&S.isSupported(),a.A.isSupported()]);return(0,f.MD)("LEDGER TRANSPORTS",{hid:t,bluetooth:e,webUsb:n}),g={hid:t,bluetooth:e,webUsb:n},{isUsbAvailable:t||n,isBluetoothAvailable:e}}async function T(){const t=await O();return t.hid?p.xy?await J(P):await J((()=>r.A.list()),(()=>r.A.create())):!!t.webUsb&&await J((()=>a.A.list()),(()=>a.A.create()))}async function z(t,e){const n=await W(t,e);return(0,s.p)("importLedgerWallet",t,n)}function N(){S&&S.openSettings()}async function k(){try{var t;if(await(null===(t=A)||void 0===t?void 0:t.isAppOpen()))return!0}catch{}if(!await U())return!1;try{return await C()}catch(t){if((0,y.HN)(t.name))return k();throw t}}async function U(t){const e=await O();t&&(m=t);try{return"bluetooth"===m?b=await async function(){if(!S)throw new Error("BLE is not supported on this device.");return(await S.connect()).bleTransport}():e.hid?b=await(p.xy?async function(){for(let t=0;t<h.PY;t++){const[t]=await P();if(t)try{return await Promise.race([H.open(t),new Promise(((t,e)=>{setTimeout((()=>e(new Error)),1e3)}))])}catch(t){await(0,v.v7)(h.Hz)}else await(0,v.v7)(h.Hz)}throw new Error("Failed to connect")}():async function(){for(let t=0;t<h.PY;t++){const[t]=await r.A.list();if(t)return t.opened?new r.A(t):r.A.open(t);await r.A.create(),await(0,v.v7)(h.Hz)}throw new Error("Failed to connect")}()):e.webUsb&&(b=await async function(){for(let t=0;t<h.PY;t++){const[t]=await a.A.list();if(t)return t.opened?await a.A.openConnected()??await a.A.request():a.A.open(t);await a.A.create(),await(0,v.v7)(h.Hz)}throw new Error("Failed to connect")}()),b?(A=new i.vs(b),!0):((0,f.SJ)("connectLedger: BLE and/or HID are not supported"),!1)}catch(t){return(0,f.SJ)("connectLedger",t),!1}}async function B(){return await(0,v.v7)(h.Hz*h.PY),!1}async function Y(){for(let r=0;r<h.PY;r++){try{var t,e,n;if(await(null===(t=A)||void 0===t?void 0:t.isAppOpen()))return null!==(e=b)&&void 0!==e&&null!==(e=e.deviceModel)&&void 0!==e&&e.id.startsWith("nanoS")&&await(null===(n=A)||void 0===n?void 0:n.getAddress((0,y.L5)(0,!1),{walletVersion:h.fE[h.Ro]})),!0}catch(t){if((0,y.HN)(t.name))throw A=void 0,t;null!=t&&t.message.includes("0x530c")||(0,f.SJ)("waitLedgerTonApp",t)}await(0,v.v7)(h.Hz)}return!1}function C(){return Promise.race([Y(),B()])}async function M(t){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const n=[];let r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)+1;try{for(;;){const a=await W(t,r);if(e.includes(a.address))r+=1;else{if(0n===a.balance)return n.length||n.push(a),n;n.push(a),r+=1}}}catch(t){return function(t){if(t instanceof d)return{error:t.displayError};throw t}(t)}}async function W(t,e){var n,r;const a="testnet"===t,{address:i,publicKey:o}=await function(t,e){const n=(0,y.L5)(t,e);return A.getAddress(n,{testOnly:e,chain:h.xk,bounceable:c.eL,walletVersion:h.fE[h.Ro]})}(e,a),l=await(0,s.p)("getWalletBalance","ton",t,i);return{index:e,address:i,publicKey:o.toString("hex"),balance:l,version:h.Ro,driver:"HID",deviceId:null===(n=b.deviceModel)||void 0===n?void 0:n.id,deviceName:null===(r=b.deviceModel)||void 0===r?void 0:r.productName}}async function I(t){const e=await(0,s.p)("fetchLedgerAccount",t),n=(0,y.w6)((0,w.cK)(t).network,e.ton);var r;await A.validateAddress(n,{bounceable:h.mN,walletVersion:(r=e.ton.version,h.fE[r])})}async function J(t,e){try{for(let n=0;n<h.eZ;n++){const[n]=await t();if(n)return!0;e&&await e(),await(0,v.v7)(h.Hz)}}catch(t){(0,f.SJ)("tryDetectDevice",t)}return!1}async function O(){return g||await R(),g}function F(){return b}x(),D()},71281:()=>{}}]);
//# sourceMappingURL=803.e64555837e9884c2e1de.js.map